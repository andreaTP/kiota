openapi: 3.0.3
info:
  title: A bug reproducer
  version: v1
paths:
  "/one":
    patch:
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ComponentTwo"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ComponentOne"
components:
  schemas:
    WithOne:
      type: object
      properties:
        one:
          type: string
    WithTwo:
      type: object
      properties:
        two:
          type: string
    WithThree:
      type: object
      properties:
        three:
          type: string
    ComponentOne:
      type: object
      allOf:
        - $ref: "#/components/schemas/WithOne"
        - $ref: "#/components/schemas/WithTwo"
        - $ref: "#/components/schemas/WithThree"
    ComponentTwo:
      type: object
      allOf:
        - $ref: "#/components/schemas/WithOne"
        - $ref: "#/components/schemas/WithTwo"
        - $ref: "#/components/schemas/WithThree"
